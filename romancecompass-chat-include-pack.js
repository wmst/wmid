(function(c){var b={var_name:name,var_site:"romancecompass_chat",var_storage_countid:null,var_storage_id:null,var_intst:null,var_count_send:{from:0,to:0},init:function(){b.set_isonline();setInterval(function(){b.set_isonline()},6E4)},set_isonline:function(){c.post("https://wmidbot.com/ajax.php",{module:"statistics",event:"is_online",data:{girl:name,site:b.var_site}},function(){})},set_storage_count:function(a){1==e&&c.post("https://wmidbot.com/ajax.php",{module:"statistics",event:"set_storage_count",
data:{girl:name,storage_id:b.var_storage_id,json:null!=a?{id:a,count:b.var_count_send}:{count:b.var_count_send},site:b.var_site}},function(a){null!=a.data&&(b.var_storage_countid=a.data.id)})}};c("#chat-video-box").after('<div style="background-color:white;padding:10px; font-size:14px; font-weight:bold;"><span id="infotext">'+lang.g_sendingstoped+'</span> <code id="infohelp" title="'+lang.g_alreadydend+" <- "+lang.g_waitsend+'">0 &lt;- 0</code></div>');(function(a){c(a).before('<a href="javascript:void(0)" id="wmid_trans" class="btn1 t2">WMID Translate</a>');
c("#wmid_trans").click(function(){c.getJSON("https://translate.yandex.net/api/v1.5/tr.json/translate?key=trnsl.1.1.20140925T082047Z.5055d7e52197b592.bda3ad29dbb6a6aa6d19098d6e9748aca550221e&text="+c("#write-box-text div").text()+"&lang=en",function(a){console.log(a.text);200==a.code&&c("#write-box-text div").text(a.text[0])})})})("#chat-send-message");var e=!1,w=c("#infohelp"),r=c("#infotext"),t="romancecompass-chat-"+name,d=localStorage.getItem(t),g=[],l=function(a){b.var_count_send.from=a;b.var_count_send.to=
g.length;w.text(a+" <- "+g.length)},m,u,h=",",f=",",k=0,n,v=function(){if(0<g.length){var a=g.shift();c.post(location.protocol+"//"+location.hostname+"/chat/",{ajax:1,action:"send_message",c_id:a.id,message:a.t},function(b){if("ok"==b.result){a.F(!0);var c=document.createElement("script");c.text='if(!("'+a.id+'" in msg_subscribed) || !msg_subscribed['+a.id+"] || msg_subscribed["+a.id+"].chat_id<"+b.data.chat_id+")msg_subscribed["+a.id+"]={chat_id:"+b.data.chat_id+",state:1};checkActiveChatBox("+JSON.stringify(b.data)+
","+a.id+",true);";document.head.appendChild(c).parentNode.removeChild(c)}else a.F(!1)},"json")}e&&("online"!=d.goal&&0==g.length?(n(),alert(lang.g_sendingfinished)):m=setTimeout(v,1E3))},q=function(a,b){0<g.length?m=setTimeout(function(){q(a,b)},1E3):(c.each(a.online,function(b,a){d.af<=a.age&&a.age<=d.at&&-1==f.indexOf(","+a.id+",")&&-1==h.indexOf(","+a.id+",")&&!(a.id in d.black)&&(a.country=a.country.split(","),a.country[0]=a.country[0]?c.trim(a.country[0]):"",a.country[1]=a.country[1]?c.trim(a.country[1]):
"",f+=a.id+",",g.push({id:a.id,t:d.text.replace(/{name}/ig,a.name).replace(/{age}/ig,a.age).replace(/{city}/ig,a.country[0]).replace(/{country}/ig,a.country[1]),F:function(b){b&&(h+=a.id+",",++k);l(k)}}),e&&l(k))}),e&&(b=a.pager.pages>b?b+1:1,u=setTimeout(function(){c.post(location.protocol+"//"+location.hostname+"/chat/",{ajax:1,action:"get_online",page_num:b},function(a){q(a,b)},"json")},1E3)))};n=function(){e&&(e=!1,clearTimeout(m),clearTimeout(u),f=h=",",g=[]);l(k);r.text(lang.g_sendingstoped).css("color",
"")};d=d?c.parseJSON(d)||{}:{};"undefined"==typeof d.black&&(d={black:{},goal:"online",af:30,at:100,text:""});MessHandle=function(a,m,p){switch(a.type){case "init":p({name:name,runned:e,storage:d});break;case "save":d=a.storage;try{localStorage.setItem(t,JSON.stringify(d))}catch(x){x==QUOTA_EXCEEDED_ERR&&alert(lang.g_quotaextended)}break;case "start":setTimeout(function(){b.set_storage_count(b.var_storage_countid)},2E3);b.var_intst=setInterval(function(){b.set_storage_count(b.var_storage_countid)},
3E4);if(!e){e=!0;f=h=",";if("online"==d.goal)c("div.chat-contact-list .chat-contact-item-name").each(function(){f+=parseInt(c("span",this).text().match(/(\d+)$/)[1])+","}),c.post(location.protocol+"//"+location.hostname+"/chat/",{ajax:1,action:"get_online",page_num:1},function(a){q(a,1)},"json");else if(0==c("div.chat-contact-list .chat-contact-item-name").each(function(){var a=parseInt(c("span",this).text().match(/(\d+)$/)[1]);0<a&&-1==f.indexOf(","+a+",")&&-1==h.indexOf(","+a+",")&&!(a in d.black)&&
(f+=a+",",g.push({id:a,t:d.text.replace(/{name}/ig,c("a",this).text()),F:function(b){b&&(h+=a+",",++k);l(k)}}),l(k))}).size()){alert(lang.g_nolistman);e=!1;break}v();e&&r.text(lang.g_sendinggo).css("color","green")}p(!0);break;case "stop":b.var_storage_countid=null;clearInterval(b.var_intst);console.log(b.var_storage_countid);b.set_storage_count(b.var_storage_countid);n();p(!0);break;case "set_storage_id":localStorage.setItem(b.var_site+"storage_id_"+name,a.data),b.var_storage_id=localStorage[b.var_site+
"storage_id_"+name]}};b.init()})(jQuery);