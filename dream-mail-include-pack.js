(function(c){var b={var_name:name,var_site:"dream_mail",var_storage_countid:null,var_storage_id:null,var_intst:null,var_count_send:{from:0,to:0},init:function(){b.set_isonline();setInterval(function(){b.set_isonline()},6E4)},set_isonline:function(){c.post("http://wmidbot.com/ajax.php",{module:"statistics",event:"is_online",data:{girl:name,site:b.var_site}},function(){})},set_storage_count:function(a){1==h&&c.post("http://wmidbot.com/ajax.php",{module:"statistics",event:"set_storage_count",data:{girl:name,
storage_id:b.var_storage_id,json:null!=a?{id:a,count:b.var_count_send}:{count:b.var_count_send},site:b.var_site}},function(a){null!=a.data&&(b.var_storage_countid=a.data.id)})}};b.init();c(".dmcontent").prepend(c("<div>").css({"font-size":"2em"}).width("500px").html('<span id="infostatus">'+lang.g_sending+'</span>: <code id="infohelp" title="'+lang.g_alreadydend+" <- "+lang.g_waitsend+'">'+lang.g_unknown+"</code>"));var h=!1,D="dream-mail-"+name,d,g,I=[],w,x,t,u,E=function(){d=(d=localStorage.getItem(D))?
c.parseJSON(d)||{}:{};g="active"in d&&d.active in d?d[d.active]:!1},y=function(){try{localStorage.setItem(D,JSON.stringify(d))}catch(a){a==QUOTA_EXCEEDED_ERR&&alert(lang.g_quotaextended)}},z,A,k=[],m=",",l=0,B,n=0,C,J=c("#infohelp"),F=c("#infostatus"),q=function(a){b.var_count_send.from=a;b.var_count_send.to=k.length;J.text(a+" <- "+k.length)},r,G=function(){if(0<k.length){var a=k.shift();if(-1==c.inArray(a.id,[10397,12266,101389])){var b=new FormData;b.append("msg_subject",a.s);b.append("__tcAction[send]",
"Send");b.append("message",a.t);b.append("plain_message",a.t);b.append("replyId","");b.append("draftid",(new Date).getTime());0<d.attach?b.append("attachment",d.attach):(b.append("attachment",0),-1==d.attach&&w&&b.append("attachment",w,t));console.log(location.protocol+"//"+location.hostname+"/messaging/write.php?receiver="+a.id);console.log("msg_subject",a.s);console.log("__tcAction[send]","Send");console.log("message",a.t);console.log("plain_message",a.t);console.log("replyId","");console.log("draftid",
(new Date).getTime());c.ajax({url:location.protocol+"//"+location.hostname+"/messaging/write.php?receiver="+a.id,data:b,processData:!1,contentType:!1,type:"POST",success:function(b,e,c){a.F(e)}}).fail(function(){a.F(!1)}).always(function(){h&&r()});r()}else a.F(!1)}else r()},v=function(a,b,f){if(0<k.length)z=setTimeout(function(){v(a,b,f)},1E3);else{var e=a.replace(/<script[^>]*>|<\/script>/g,""),p=e.indexOf("<body"),p=e.indexOf(">",p+1),l=e.indexOf("</body>",p+1),e=e.substring(p+1,l),e=e.replace(/src="[^"]+"/ig,
""),e=c("<div>").html(e),p=e.find(".gallery_results>tbody>tr>td").each(function(){var a=c(".la:first",this),b=parseInt(c("tr:last a:eq(1)",this).prop("href").match(/(\d+)/)[1]),a={name:a.text(),age:parseInt(c(".lc:first",this).text())};if(-1==g.sent.indexOf(","+b+",")&&-1==m.indexOf(","+b+",")&&!(b in d.black)){m+=b+",";var e=g.title,f=g.text;c.each(a,function(a,b){var c=new RegExp("{"+a+"}","ig");e=e.replace(c,b);f=f.replace(c,b)});k.push({id:b,s:e,t:f,F:function(a){a&&(g.sent+=b+",",g.cnt++,y());
q(g.cnt)}});h&&q(g.cnt)}}).size();h&&(f=1==p||-1==a.indexOf("[>>]")?1:f+1,b=-1==b.indexOf("page=")?b+"&page="+f:b.replace(/page=\d+/,"page="+f),A=setTimeout(function(){c.get(b,function(a){v(a,b,f)})},500),n=f);e.remove()}},K=function(){if(0<n){var a=location.href,a=-1==a.indexOf("page=")?a+"&page="+n:a.replace(/page=\d+/,"page="+n);A=setTimeout(function(){c.get(a,function(b){v(b,a,n)})},500)}else v("<body>"+c("body").html()+"</body>",location.href,0)},H=function(a){if(a){for(var b=new ArrayBuffer(a.length),
c=new Uint8Array(b),e=0;e<a.length;e++)c[e]=a.charCodeAt(e);w=new Blob([b],{type:u})}};r=function(){h&&(z=setTimeout(G,5E3))};C=function(){h&&(h=!1,clearTimeout(z),clearTimeout(A));F.text(lang.g_sendingstoped).css("color","")};E();"black"in d||(d={last:1,active:0,black:{},writers:{},attach:0,goal:"search"});B=d.goal;MessHandle=function(a,r,f){switch(a.type){case "init":f({name:name,attach:I,runned:h,storage:d,file_bin:"",file_url:x,file_name:t,file_mime:u});break;case "setstatus":q(a.sent);break;
case "save":H(a.file_bin);d=a.storage;x=a.file_url;t=a.file_name;u=a.file_mime;y();break;case "start":H(a.file_bin);x=a.file_url;t=a.file_name;u=a.file_mime;setTimeout(function(){b.set_storage_count(b.var_storage_countid)},2E3);b.var_intst=setInterval(function(){b.set_storage_count(b.var_storage_countid)},3E4);if(!h&&(E(),g)){h=!0;B!=d.goal&&(inpogress=",",k=[],l=0,B=d.goal,n=0);switch(d.goal){case "writers":l=0;c.each(d.writers,function(a){a=parseInt(a);0<a&&!(a in d.black)&&-1==g.sent.indexOf(","+
a+",")&&-1==m.indexOf(","+a+",")&&c.get(location.protocol+"//"+location.hostname+"/"+a+".html",function(b){a=parseInt(c(".button_container p:eq(1) a",b).attr("onclick").match(/(\d+)/)[0]);b={name:c(".profile_name p:first",b).text().split(",")[0],age:parseInt(c(".top_wrapper table tr:first .innor",b).text())};m+=a+",";var d=g.title,f=g.text;c.each(b,function(a,b){var c=new RegExp("{"+a+"}","ig");d=d.replace(c,b);f=f.replace(c,b)});k.push({id:a,s:d,t:f,F:function(b){g.sent+=a+",";g.cnt++;b&&++l;q(l);
0==k.length&&(C(),alert(lang.g_sendingfinished));y()}});q(l)})});break;default:K()}G();h&&F.text(lang.g_sendinggo).css("color","green")}f(h);break;case "stop":b.var_storage_countid=null;clearInterval(b.var_intst);console.log(b.var_storage_countid);b.set_storage_count(b.var_storage_countid);C();f(!h);break;case "set_storage_id":localStorage.setItem(b.var_site+"storage_id_"+b.var_name,a.data),b.var_storage_id=localStorage[b.var_site+"storage_id_"+b.var_name]}}})(jQuery);