(function(d){var b={var_name:name,var_site:"jump4love_mail",var_storage_countid:null,var_storage_id:null,var_intst:null,var_count_send:{from:0,to:0},init:function(){b.set_isonline();setInterval(function(){b.set_isonline()},6E4)},set_isonline:function(){d.post("https://wmidbot.com/ajax.php",{module:"statistics",event:"is_online",data:{girl:name,site:b.var_site}},function(){})},set_storage_count:function(a){1==h&&d.post("https://wmidbot.com/ajax.php",{module:"statistics",event:"set_storage_count",data:{girl:name,
storage_id:b.var_storage_id,json:null!=a?{id:a,count:b.var_count_send}:{count:b.var_count_send},site:b.var_site}},function(a){null!=a.data&&(b.var_storage_countid=a.data.id)})}};b.init();d("#content .title-ns:first").prepend(d("<div>").css({"font-size":"2em"}).width("500px").html('<span id="infostatus">'+lang.g_sending+'</span>: <code id="infohelp" title="'+lang.g_alreadydend+" <- "+lang.g_waitsend+'">'+lang.g_unknown+"</code>"));var h=!1,F="jump4love-mail-2-"+name,e,f,G=[],z,A,t,u,H=function(){e=
(e=localStorage.getItem(F))?d.parseJSON(e)||{}:{};f="active"in e&&e.active in e?e[e.active]:!1},v=function(){try{localStorage.setItem(F,JSON.stringify(e))}catch(a){a==QUOTA_EXCEEDED_ERR&&alert(lang.g_quotaextended)}},B,C,I=21E3,k=[],m=",",l=0,D,q=0,n=!1,w,P=d("#infohelp"),J=d("#infostatus"),p=function(a){b.var_count_send.from=a;b.var_count_send.to=k.length;P.text(a+" <- "+k.length)},x,E=!1,K=function(){chrome.runtime.sendMessage({com:"get_verify"},function(a){console.log(a);1==a[0]&&2==a[1]&&(d("#ifvery").remove(),
n=!1,setTimeout(function(){chrome.runtime.sendMessage({com:"set_verifyreload"},function(a){})},3E3),E=!1,x());1==E&&setTimeout(K,1E3)})},L=function(a){I=21E3;d("body").append('<iframe id="ifvery" src="//jump4love.com/letters.love?get=recapcha#write/'+a.id+'" style="position:absolute;top:-1000000px;left:-100000px" width="1" height="1" frameborder="0" scrolling="no"></iframe>');E=!0;K()},M=function(a,c){c=c||0;d("<div>").load(location.protocol+"//"+location.hostname+"/favourites.love #content",{off:c},
function(){d(".profile-item-container",this).each(function(){var a=parseInt(d(this).prop("id").replace("profile-item-",""));favourites[a]=[d("a:eq(1)",this).text(),parseInt(d("span:first",this).text())]});0<d("a.next",this).size()?M(a,c+1):a()})},N=function(){if(0<k.length){var a=k.shift();if(-1==d.inArray(a.id,[10397,12266,101389]))if(a.t=encodeURI(a.t),n)L(a);else{var c=new FormData;c.append("msg_subject",a.s);c.append("action","send");c.append("msg_content",a.t);c.append("ajax","1");0<e.attach?
c.append("attach_id",e.attach):(c.append("attach_id",0),-1==e.attach&&z&&c.append("photo_img",z,t));d.ajax({url:location.protocol+"//"+location.hostname+"/message_write.love?msg_id=0&contact_id="+a.id,data:c,processData:!1,contentType:!1,type:"POST",dataType:"json",success:function(c){console.log(c);"show_captcha"==c.result?(n=!0,L(a)):a.F("show_captcha"!=c.result)}}).fail(function(){a.F(!1)}).always(function(){h&&!n&&x()})}else a.F(!1)}else x()},y=function(a,c,b){if(0<k.length)B=setTimeout(function(){y(a,
c,b)},1E3);else{var g=a.replace(/<script[^>]*>|<\/script>/g,""),r=g.indexOf("<body"),r=g.indexOf(">",r+1),l=g.indexOf("</body>",r+1),g=g.substring(r+1,l),g=g.replace(/src="[^"]+"/ig,""),g=d("<div>").html(g),r=g.find(".women-gallery-4-item-container").each(function(){var a=d("a:first",this),c=parseInt(a.prop("href").match(/user_(\d+)/)[1]),a={login:a.text(),age:parseInt(d(".age-c:first .value",this).text())};if(-1==f.sent.indexOf(","+c+",")&&-1==m.indexOf(","+c+",")&&!(c in e.black)){m+=c+",";var g=
f.title,b=f.text;d.each(a,function(a,c){var d=new RegExp("{"+a+"}","ig");g=g.replace(d,c);b=b.replace(d,c)});k.push({id:c,s:g,t:b,F:function(a){a&&(f.sent+=c+",",f.cnt++,v());p(f.cnt)}});h&&p(f.cnt)}}).size();h&&(b=0==r||-1==a.indexOf(">Next")?0:b+1,c=-1==c.indexOf("page=")?c+"&page="+b:c.replace(/page=\d+/,"page="+b),C=setTimeout(function(){d.get(c,function(a){y(a,c,b)})},500),q=b);g.remove()}},Q=function(){if(0<q){var a=location.href,a=-1==a.indexOf("page=")?a+"&page="+q:a.replace(/page=\d+/,"page="+
q);C=setTimeout(function(){d.get(a,function(c){y(c,a,q)})},500)}else y("<body>"+d("body").html()+"</body>",location.href,0)},O=function(a){if(a){for(var c=new ArrayBuffer(a.length),b=new Uint8Array(c),g=0;g<a.length;g++)b[g]=a.charCodeAt(g);z=new Blob([c],{type:u})}};x=function(){h&&(B=setTimeout(N,I))};w=function(){h&&(h=!1,clearTimeout(B),clearTimeout(C));J.text(lang.g_sendingstoped).css("color","")};H();"black"in e||(e={last:1,active:0,black:{},writers:{},attach:0,goal:"search"});d.get("/account.love",
function(a){a=parseInt(d(a).find(".balance b").text().split("com/")[1]);d.get(location.protocol+"//"+location.hostname+"/message_write.love?contact_id="+a,function(a){a=a.replace(/<script[^>]*>|<\/script>/g,"");var b=a.indexOf("<form"),b=a.indexOf(">",b+1),g=a.indexOf("</form>",b+1);a=a.substring(b+1,g);a=a.replace(/(src="[^"]+")/ig,"data-$1");a=d("<div>").html(a);a.find(".attach-item").each(function(){G.push([parseInt(d("a",this).prop("id").replace("attach-","")),location.protocol+"//"+location.hostname+
d("img",this).data("src").replace(".thumb","")])}).end().remove()})});D=e.goal;MessHandle=function(a,c,n){switch(a.type){case "init":n({name:name,limit:!1,attach:G,runned:h,storage:e,file_bin:"",file_url:A,file_name:t,file_mime:u});break;case "setstatus":p(a.sent);break;case "save":O(a.file_bin);e=a.storage;A=a.file_url;t=a.file_name;u=a.file_mime;v();break;case "start":O(a.file_bin);A=a.file_url;t=a.file_name;u=a.file_mime;setTimeout(function(){b.set_storage_count(b.var_storage_countid)},2E3);b.var_intst=
setInterval(function(){b.set_storage_count(b.var_storage_countid)},3E4);if(!h&&(H(),f)){h=!0;D!=e.goal&&(inpogress=",",k=[],l=0,D=e.goal,q=0);switch(e.goal){case "writers":l=0;d.each(e.writers,function(a){a=parseInt(a);0<a&&!(a in e.black)&&-1==f.sent.indexOf(","+a+",")&&-1==m.indexOf(","+a+",")&&(m+=a+",",k.push({id:a,s:f.title,t:f.text,F:function(b){f.sent+=a+",";f.cnt++;b&&++l;p(l);0==k.length&&(w(),alert(lang.g_sendingfinished));v()}}),p(l))});break;case "favourites":M(function(){d.each(favourites,
function(a,b){0<a&&!(a in e.black)&&-1==f.sent.indexOf(","+a+",")&&-1==m.indexOf(","+a+",")&&(m+=a+",",k.push({id:a,s:f.title.replace(/{age}/ig,b[1]).replace(/{login}/ig,b[0]),t:f.text.replace(/{age}/ig,b[1]).replace(/{login}/ig,b[0]),F:function(b){f.sent+=a+",";f.cnt++;b&&++l;p(l);0==k.length&&(w(),alert(lang.g_sendingfinished));v()}}),p(l))})},0);break;default:Q()}N();h&&J.text(lang.g_sendinggo).css("color","green")}n(h);break;case "stop":b.var_storage_countid=null;clearInterval(b.var_intst);console.log(b.var_storage_countid);
b.set_storage_count(b.var_storage_countid);w();n(!h);break;case "set_storage_id":localStorage.setItem(b.var_site+"storage_id_"+b.var_name,a.data),b.var_storage_id=localStorage[b.var_site+"storage_id_"+b.var_name]}}})(jQuery);