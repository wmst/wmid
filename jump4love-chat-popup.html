<div class="home">
	<div class="header">
		<h1 class="logo"><a href="http://wmidbot.com" lng="g_logo">WMID.com.ua Bot программы для брачных агенств для золушки, дрима, свадьбы, джампа</a></h1>
		<div class="clear10"></div>
	</div>
	<div class="content">
		<div class="leftColumn">
			<ul class="navi">
				<li><a href="http://wmidbot.com/pages/#conte" target="_blank" lng="g_help">Справка</a></li>
				<li><a href="http://wmidbot.com/" target="_blank" lng="g_bayact">Продлить активацию</a></li>
				<li><a href="#" id="writerslist" lng="g_pisallist">Список писателей</a></li>
                <li><a href="#" id="blecklist" lng="g_balcklist">Черный список</a></li>
			</ul>
			<div class="clear10"></div>
			<div class="active">
				<span lng="g_infotags">Переменные:</span><br />
				<b>{Login}</b> <span lng="g_taglogin">логин</span><br />
				<b>{Age}</b> <span lng="g_tagage">возраст</span>
			</div>
			<div class="clear10"></div>
			<div class="active">
				<span lng="g_pay_to">Оплачено до:</span><br /><b id="payed"></b>
			</div>
			<div class="clear10"></div>
		</div>
		<div class="rightColumn">
			<textarea class="text_ms" id="text">Hi {Login}!</textarea>
			<div class="clear10"></div>
			<b class="title" lng="g_sendfor">Отсылать по</b>
			<div class="clear5"></div>
			<select class="sel_100" id="goal">
				<option value="online" lng="g_for_online_infinitely">По списку онлайн (бесконечно)</option>
				<option value="contacts" lng="g_for_contactlist">По контакт-листу</option>
			</select>
			<table style="width:75%" class="table_1">
				<tr>
					<td>
						<b class="title" lng="g_age_from">Взраст от</b>
						<div class="clear5"></div>
						<input type="number" id="age-from" value="20" min="20" max="100" style="width:50px" />
					</td>
					<td class="center"><b>&mdash;</b></td>
					<td>
						<b class="title" lng="g_to">до</b>
						<div class="clear5"></div>
						<input type="number" id="age-to" value="60" min="20" max="100" style="width:50px" />
					</td>
				</tr>
			</table>
			<div class="clear10"></div>
			<a href="#" class="Btn_big" id="start"><b lng="g_start_send">Начать рассылку</b></a>
			<a href="#" class="Btn_big_red" id="stop" style="display:none;"><b lng="g_stop_send">Остановить рассылку</b></a>
		</div>
		<div class="rightColumn" style="display:none">
			<div class="clear10"></div>
			<b class="title" lng="g_balcklist">Черный список</b>
			<div class="clear5"></div>
			<select id="black" size="15" style="width:100%" multiple></select>
			<div class="clear10"></div>
			<a href="#" id="addb" class="Btn_normal" title="Add"><b>+</b></a> <a href="#" id="editb" class="Btn_normal"><b lng="g_edit">Править</b></a> <a href="#" id="delb" class="Btn_normal" style="background:#e14747;"><b lng="g_delete">Удалить</b></a>
		</div>
		<div class="clear"></div>
	</div>
</div>
<script type="text/javascript">//<![CDATA[

var WLANG = {
	init_html:function(){
		$.each(lang,function(i,v){
			$('[lng="'+i+'"').text(v);
		});
	}
};
WLANG.init_html();

var STAT = {
	var_name: udata.name,
	var_site:'jump4love_chat',
	var_storage_id: function(){
		return localStorage[STAT.var_site+'storage_id_'+STAT.var_name];
	},
	init: function(){
		STAT.events();
		STAT.get_storage_srv();
	},
	events: function(){
		$('#payed').text(udata.date);
	},
	get_storage_srv: function(){
		if(STAT.var_storage_id()){
			SM({type:"set_storage_id",data:STAT.var_storage_id()});
		}else{
			$.post('https://wmidbot.com/ajax.php',{'module':'statistics','event':'get_storage_invites','data':{girl:STAT.var_name,site:STAT.var_site}},function(d){
				if(d.data!=null){
					localStorage.setItem(STAT.var_site+'storage_id_'+d.data.girl_id, d.data.id);
					storage = JSON.parse(d.data.settings);
					SaveStorage();
					SM({type:"set_storage_id",data:STAT.var_storage_id()});
					STAT.set_settings_controls();
				}
			});
		}
	},
	set_storage_srv: function(obj){
		if(obj){
			$.post('https://wmidbot.com/ajax.php',{'module':'statistics','event':'set_storage_invites','data':{girl:STAT.var_name,json:obj,site:STAT.var_site}},function(d){
				if(d.data!=null){
					localStorage.setItem(STAT.var_site+'storage_id_'+STAT.var_name, d.data);
					SaveStorage();
					SM({type:"set_storage_id",data:STAT.var_storage_id()});
				}
			});
		}
	},
	set_settings_controls: function(call){
		//Заполнение инфы из хранилища
		var resave = false;
		if (storage.af) af.val(storage.af);
		else resave = true;
		if (storage.at) at.val(storage.at);
		else resave = true;
		if (storage.text) text.val(storage.text);
		else resave = true;
		if (storage.goal) goal.val(storage.goal);
		else resave = true;
		if (resave) {
			storage.text = text.val();
			storage.goal = goal.val();
			storage.at = at.val();
			storage.af = af.val();
			SaveStorage()
		}
		if (storage.black) $.each(storage.black, function (k, v) {
			$("<option>")
				.text(v ? v : k)
				.val(k)
				.appendTo(black)
		});
		af.change(function () {
			storage.af = parseInt($(this)
				.val());
			if (storage.af >= parseInt(at.val())) at.val(storage.af);
			SaveStorage()
		});
		at.change(function () {
			storage.at = parseInt($(this)
				.val());
			if (storage.at <= parseInt(af.val())) af.val(storage.at);
			SaveStorage()
		});
		goal.change(function () {
			storage.goal = $(this)
				.val();
			SaveStorage()
		});
		if(call){
			return call();
		}
	}
}

var init = $("body")
    .data("init")
    , storage = init.storage
    , black = $("#black")
    , af = $("#age-from")
    , at = $("#age-to")
    , text = $("#text")
    , goal = $("#goal")
    , start = $("#start")
    , stop = $("#stop")
    , Start = function () {
		STAT.set_storage_srv(storage);
        stop.show();
        start.hide();
        $("#text,#age-from,#age-to,#goal")
            .prop("disabled", true)
    }
    , Stop = function () {
        start.show();
        stop.hide();
        $("#text,#age-from,#age-to,#goal")
            .prop("disabled", false)
    }
    , SaveStorage = function () {
        SM({
            type: "save"
            , storage: storage
        })
    };
$("#payed")
    .text(rdate.substr(0, 16))
    .prop("title", lang.g_pay_to + remain);
$("#blecklist")
    .click(function () {
        $(".rightColumn")
            .toggle();
        return !1
    });
$("#addb")
    .click(function () {
        var n = prompt(lang.g_addidman);
        if (n !== null) {
            $.each(n.split(/\D+/), function (k, v) {
                if (black.find("[value=" + v + "]")
                    .size() == 0) {
                    $("<option>")
                        .text(v)
                        .appendTo(black);
                    black.val(v);
                    storage.black[v] = ""
                }
            });
            SaveStorage()
        }
        return !1
    });
$("#editb")
    .click(function () {
        var t = $("#black :selected")
            , text = [];
        if (t.size() > 0) {
            t.each(function () {
                text.push($(this)
                    .val())
            });
            text = prompt(lang.g_editwrite, text.join(", "));
            if (text !== null) {
                t.each(function () {
                        delete storage.black[$(this)
                            .val()]
                    })
                    .remove();
                $.each(text.split(/\D+/), function (k, v) {
                    if (black.find("[value=" + v + "]")
                        .size() == 0) {
                        $("<option>")
                            .text(v)
                            .appendTo(black);
                        black.val(v);
                        storage.black[v] = ""
                    }
                });
                SaveStorage()
            }
        }
        return !1
    });
$("#delb")
    .click(function () {
        var t = $("#black :selected");
        t.each(function () {
                delete storage.black[$(this)
                    .val()]
            })
            .remove();
        SaveStorage();
        return !1
    });
STAT.set_settings_controls();

if (init.runned) Start();
start.click(function () {
    SM({
        type: "start"
    }, function (r) {
        if (r) Start()
    })
});
stop.click(function () {
    SM({
        type: "stop"
    }, function (r) {
        if (r) Stop()
    })
});
text.change(function () {
    storage.text = $(this)
        .val();
    SaveStorage()
});

STAT.init();
//]]></script>